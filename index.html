<!-- index.html -->
<!DOCTYPE html>
<html>
<head>
  <title>Google 로그인 및 관리자 기능</title>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js"></script>
</head>
<body>
  <button id="loginButton">Google 로그인</button>
  <div id="userInfo" style="display:none;">
    <p>아이디: <span id="userEmail"></span></p>
    <p>내 잔액: <span id="userBalance">0</span></p>
    <div id="adminPanel" style="display:none;">
      <h3>관리자 탭</h3>
      <input type="email" id="targetEmail" placeholder="잔액 추가할 이메일">
      <input type="number" id="amount" placeholder="추가할 금액">
      <button id="addBalanceButton">잔액 추가</button>
    </div>
  </div>

  <script>
    // Firebase SDK 함수 가져오기 및 초기화 코드
    import { initializeApp } from "firebase/app";
    import { getAnalytics } from "firebase/analytics";

    // Firebase 구성
    const firebaseConfig = {
      apiKey: "AIzaSyD1Xz0ZYCOsauT2ga1awdSkh87IA8OMRiU",
      authDomain: "n00001-4ff1e.firebaseapp.com",
      projectId: "n00001-4ff1e",
      storageBucket: "n00001-4ff1e.firebasestorage.app",
      messagingSenderId: "575173293295",
      appId: "1:575173293295:web:4dbb1e44760dc3bcce171a",
      measurementId: "G-38JLDN4DJH"
    };

    // Firebase 초기화
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);

    // 나머지 코드 (이전에 제공한 Google 로그인 및 Firestore 코드)
    const auth = firebase.auth();
    const db = firebase.firestore();

    document.getElementById('loginButton').addEventListener('click', () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider).then(result => {
        const user = result.user;
        document.getElementById('userEmail').textContent = user.email;
        document.getElementById('userInfo').style.display = 'block';

        if (user.email === "gimeungyeol5@gmail.com") {
          document.getElementById('adminPanel').style.display = 'block';
        }

        db.collection('users').doc(user.uid).get().then(doc => {
          if (doc.exists) {
            document.getElementById('userBalance').textContent = doc.data().balance;
          } else {
            db.collection('users').doc(user.uid).set({ balance: 0 });
            document.getElementById('userBalance').textContent = 0;
          }
        });
      }).catch(error => {
        console.error("로그인 오류: ", error);
      });
    });

    document.getElementById('addBalanceButton').addEventListener('click', () => {
      const targetEmail = document.getElementById('targetEmail').value;
      const amount = parseInt(document.getElementById('amount').value, 10);

      if (targetEmail && !isNaN(amount)) {
        db.collection('users').where('email', '==', targetEmail).get().then(querySnapshot => {
          if (!querySnapshot.empty) {
            querySnapshot.forEach(doc => {
              db.collection('users').doc(doc.id).update({
                balance: firebase.firestore.FieldValue.increment(amount)
              }).then(() => {
                alert('잔액이 추가되었습니다.');
              }).catch(error => {
                console.error("잔액 업데이트 오류: ", error);
              });
            });
          } else {
            alert('해당 이메일을 가진 사용자가 없습니다.');
          }
        }).catch(error => {
          console.error("쿼리 오류: ", error);
        });
      } else {
        alert('올바른 이메일과 금액을 입력하세요.');
      }
    });
  </script>
</body>
</html>
